<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Vue Test</title>

    <!-- This is a development version of Vue.js! -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.3/dist/algoliasearch-lite.umd.js"
      integrity="sha256-dyJcbGuYfdzNfifkHxYVd/rzeR6SLLcDFYEidcybldM="
      crossorigin="anonymous"
    ></script>

    <!-- For Vue 2: -->
    <script
      src="https://cdn.jsdelivr.net/npm/vue-instantsearch@4.8.5/vue2/umd/index.js"
      integrity="sha256-piDGip8zOS04Sb8ea8q3UAtZxVG0s66Gg3+YV2Tp2q4="
      crossorigin="anonymous"
    ></script>

    <!-- main css -->
    <link rel="stylesheet" href="./styling/main.css">

    <!-- Google fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      rel="stylesheet"
    />
    <!-- Bootstrap v5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div id="app" class="experiment-block">
      <ais-instant-search
        index-name="Product"
        v-bind:search-client="searchClient"
      >
        <ais-configure
          :attributes-to-snippet.camel="['description:10']"
          :snippet-ellipsis-text.camel="'…'"
          :remove-words-if-no-result.camel="'allOptional'"
        />
        <header class="py-5 container">
          <ais-search-box
            submit-title="Submit the query"
            :class-names="{
                'ais-SearchBox': 'row justify-content-end',
                'ais-SearchBox-submit': 'btn btn-primary rounded-0',
                'ais-SearchBox-input': 'form-control inline-block border-0 shadow-none mw-50',
                'ais-SearchBox-form': 'd-flex gap-3 col-md-12 col-xl-10 justify-content-end border rounded p-1',
                'ais-SearchBox-reset': 'btn btn-danger'
            }"
          >
            <template v-slot="{ aisSearchBox, refine, currentRefinement, isSearchStalled }">
              <form action="" role="search" novalidate="novalidate"
                :class="searchInputFocused ? 'border-primary border-2 shadow shadow-info shadow-intensity-lg': 'border-dark'"
                class="ais-SearchBox-form d-flex justify-content-end border rounded p-1">
                <button v-if="currentRefinement === ''" type="submit" title="Submit the query" class="ais-SearchBox-submit btn  rounded-0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="16" height="16"><g fill="none" fill-rule="evenodd" :stroke="searchInputFocused ? 'blue' : 'currentColor'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.67" transform="translate(1 1)"><circle cx="7.11" cy="7.11" r="7.11"></circle> <path d="M16 16l-3.87-3.87"></path></g></svg></button> <button type="reset" title="Clear" hidden="hidden" class="ais-SearchBox-reset btn btn-danger"><svg role="img" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" class="ais-SearchBox-resetIcon"><path d="M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z" fillRule="evenodd"></path></svg></button>
                <button v-if="currentRefinement !== ''" @click="refine(''); $refs.query.focus()" type="reset" title="Clear" class="ais-SearchBox-reset btn"><svg role="img" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" class="ais-SearchBox-resetIcon"><path fill="blue" d="M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z" fillRule="evenodd"></path></svg></button>
                <input
                :value="currentRefinement"
                @input="refine($event.currentTarget.value)"
                @focus="searchInputFocused = true" @blur="searchInputFocused = false"
                :class="currentRefinement === '' && !searchInputFocused ? 'w-no-text': 'w-with-text'"
                :placeholder="searchInputFocused ? '':'Search here…'" class="ais-SearchBox-input form-control inline-block border-0 shadow-none mw-50"
                ref="query"
                type="search" 
                autocorrect="off"
                autocapitalize="off"
                autocomplete="off"
                spellcheck="false"
                required="required"
                maxlength="512"
                aria-label="Search"
                >
                <button v-if="currentRefinement === ''" class="btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor" class="h4" style="margin-bottom: 0;"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V5.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.41 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></svg>
                </button>
                <span class="w-1"></span>
                <button v-if="currentRefinement === ''" class="btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14.12 4l1.83 2H20v12H4V6h4.05l1.83-2h4.24M15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm-3 7c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3m0-2c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5z"></path></svg>
                </button>
                <button v-if="currentRefinement !== ''" class="btn btn-primary">Search</button>
              </form>
              <span :hidden="!isSearchStalled">Loading...</span>
            </template>
          </ais-search-box>
        </header>
        <main>
          <ais-hits
            :class-names="{

           }"
            :transform-items="transformItems"
          >
          <template v-slot="{ items, sendEvent }">
            <div class="container py-5">
                <div v-for="item in items" :key="item.objectID" class="row justify-content-center mb-3">
                  <div class="col-md-12 col-xl-10 p-0">
                    <div class="card shadow-0 border rounded-3">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-12 col-lg-3 col-xl-3 mb-4 mb-lg-0">
                            <div class="bg-image hover-zoom ripple rounded ripple-surface">
                              <img :src="item.image !== '' ? 'https://emmano.pl/media/'+item.image : 'https://dummyimage.com/640x360/fff/aaa'"
                                class="w-100" />
                              <a href="#!">
                                <div class="hover-overlay">
                                  <div class="mask" style="background-color: rgba(253, 253, 253, 0.15);"></div>
                                </div>
                              </a>
                            </div>
                          </div>
                          <div class="col-md-6 col-lg-6 col-xl-6">
                            <h5>{{ item.name }}</h5>
                            <div class="d-flex flex-row">
                              <div class="text-danger mb-1 me-2">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                              </div>
                              <span>310</span>
                            </div>
                            <div class="mt-1 mb-0 text-muted small">
                              <span>100% cotton</span>
                              <span class="text-primary"> • </span>
                              <span>Light weight</span>
                              <span class="text-primary"> • </span>
                              <span>Best finish<br /></span>
                            </div>
                            <div class="mb-2 text-muted small">
                              <span>Unique design</span>
                              <span class="text-primary"> • </span>
                              <span>For men</span>
                              <span class="text-primary"> • </span>
                              <span>Casual<br /></span>
                            </div>
                            <p class="text-truncate mb-4 mb-md-0">{{ item.short_description ? item.short_description : 'lorem ipsum sit dolor amet sit aba lse. joh lske. asdf jkelo jiul jijlalj.'}}</p>
                          </div>
                          <div class="col-md-6 col-lg-3 col-xl-3 border-sm-start-none border-start">
                            <div class="d-flex flex-row align-items-center mb-1">
                              <h4 class="mb-1 me-1">$13.99</h4>
                              <span class="text-danger"><s>$20.99</s></span>
                            </div>
                            <h6 class="text-success">Free shipping</h6>
                            <div class="d-flex flex-column mt-4">
                              <button class="btn btn-primary btn-sm" type="button">Details</button>
                              <button class="btn btn-outline-primary btn-sm mt-2" type="button">
                                Add to wishlist
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
          </template>
          </ais-hits>
        </main>
      </ais-instant-search>
    </div>

    <script type="module">
      const app = new Vue({
        el: "#app",
        data: {
          searchClient: algoliasearch(
            "1LSUQ7GW58",
            "386f5ab5b40107abc10ff3863afa7e90"
          ),
          searchInputFocused: false,
        },
        methods: {
          transformItems(items, { results }) {
            return items.map((item, index) => ({
              ...item,
              position: { index, page: results.page },
            }));
          },
          test() {
            console.log('test');
          }
        },
        watch: {
          searchInputFocused() {
            
          }
        }
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
